# DeathEvent 共同死亡事件插件

- 作者: Kimi、羽学
- 出处: TShock官方群816771079
- 这是一个Tshock服务器插件，主要用于：有一个玩家死亡使全部在线玩家全部执行死亡,并提供重生补偿,支持队伍模式。

## 更新日志

```
v1.0.6
重构部分代码
将重要的相关数据移到了死亡数据缓存.json中
加入了管理分配队伍指令:/det fp（支持在线索引和离线名称查找）
可无视队伍申请分配玩家队伍,并自动写入队伍缓存方便进服恢复,
指令后缀加-L可锁定该玩家队伍使其无法切换
加入了【集体死亡】配置项，用于控制是否开启共同死亡功能(/det s kill)
使用det菜单指令可查看个人信息(当有投票时队伍玩家优先看见投票明细)
优化了死亡时的播报内容，恢复了队伍名字颜色显示
/det s time 可设负数，表示不修改复活时间(采用服务器的复活时间)
/det reset all 指令支持清理投票数据

v1.0.5
加入并完善了det指令功能
指令授权示意:/group addprem default det.use
加入了队伍申请功能，当开启【队伍申请】配置项时:
切换队伍时会向该队伍的玩家发送申请队伍，该队伍的玩家需要使用/det y和 n指令来参与投票
投票时间结束后，若赞成票超过50%则加入该队伍，否则申请者维持原队伍不变
队伍没人、处于白名单、拥有det.admin权限可以直接加入
为了避免频繁写入配置文件
将配置文件放到了tshock的《共同死亡事件》文件夹
把频繁写入的缓存文件放到了`死亡数据缓存.json`
注意:可将/det res all指令写到自动重置插件里,清空"死亡数据缓存"

v1.0.4
加入了队伍激励功能
当前队伍死亡会从队伍内所有玩家:
每人随机抽取1件物品,奖励给其他队伍作为激励
扣除物品者与收到物品者都会收到通知
注意：本功能须在SSC强制开荒状态下才会生效

v1.0.3
优化了代码结构
加入了死亡次数统计（个人与队伍）
加入了进服自动还原队伍功能
加入了队伍切换冷却功能，避免频繁切换队伍刷死亡次数。
白名单玩家无视队伍切换冷却限制。

v1.0.2
尝试修复偶尔死亡同步失效问题
修复共同死亡复活时间问题
加入了同步最高生命功能(每次玩家生成时会查找服务器血量最高的玩家同步为自己生命值)
加入了补偿冷却功能，避免有人恶意利用机制刷血量上限从而降低游戏难度。
加入了队伍模式功能，开启后仅对同队伍的玩家执行共同死亡。
加入了超出服务器上限功能，当开启时：
血量和魔力超出服务器上限则会修改TShock的配置文件提高上限值，反之限制最高值。

v1.0.1
将补偿事件放到玩家复活后执行
```

## 指令

| 语法      |    权限     |        说明        |
| --------- | :---------: | :----------------: |
| /det [yes/no] | det.use |   申请加入队伍投票   |
| /det v | det.use |   查看投票状态   |
| /det fp | det.admin |   分配玩家队伍   |
| /det ck | det.use |   查数据   |
| /det wl | det.use |   查白名单   |
| /det item | det.use |   查补尝物品   |
| /det cmd | det.use |   查补尝命令   |
| /det evt | det.use |   查死亡事件   |
| /det [on/off] | det.admin |   插件开关   |
| /det rst | det.admin |   重置数据   |
| /det s | det.admin |   修改配置指令菜单   |
| /det s kill | det.admin |   集体死亡开关   |
| /det s tm | det.admin |   队伍模式开关   |
| /det s rew | det.admin |   队伍激励开关   |
| /det s app | det.admin |   队伍申请开关   |
| /det s sync | det.admin |   同步最高生命者开关   |
| /det s exce | det.admin |   超出服务器上限开关   |
| /det s item | det.admin |   重生补尝物品开关   |
| /det s item 物名 | det.admin |   修改补尝物品   |
| /det s item 物名 数量 | det.admin |   设置物品数量   |
| /det s cmd 命令 | det.admin |   修改补尝命令   |
| /det s wl 玩家名 | det.admin |   修改免疫名单   |
| /det s life 数值 | det.admin |   设置补尝生命   |
| /det s mana 数值 | det.admin |   设置补尝魔力   |
| /det s time 秒 | det.admin |   设置复活时间   |
| /det s cool 秒 | det.admin |   设置补尝冷却   |
| /det s cd 秒 | det.admin |   设置队伍切换CD   |
| /det s vt 秒 | det.admin |   设置投票时间   |
| /reload | tshock.cfg.reload | 重新加载插件配置 |

## 配置
> 配置文件位置：tshock/共同死亡事件/共同死亡配置.json
```json
{
  "插件开关": true,
  "集体死亡": true,
  "队伍模式": true,
  "队伍激励": true,
  "队伍申请": true,
  "投票时间": 30,
  "切换队伍冷却": 30,
  "复活时间": 3,
  "补偿冷却": 180,
  "补偿增加生命": 30,
  "补偿增加魔力": 10,
  "同步最高生命者": true,
  "超出服务器上限": true,
  "补偿物品": true,
  "补偿物品表": {
    "74": 1
  },
  "补偿执行命令": [
    "/buff 8 360"
  ],
  "免疫名单": [
    "羽学",
    "Kimi"
  ]
}
```
## 缓存文件
> 缓存文件位置：tshock/共同死亡事件/死亡数据缓存.json
```json
{
  "队伍数据": {
    "红队": {
      "死亡次数": 1,
      "已死亡玩家名单": [
        "灵乐"
      ],
      "已复活玩家名单": []
    },
    "白队": {
      "死亡次数": 1,
      "已死亡玩家名单": [],
      "已复活玩家名单": []
    }
  },
  "玩家数据": {
    "灵乐": {
      "锁定队伍": false,
      "死亡次数": 2,
      "队伍缓存": "红队",
      "切换队伍时间": "2026-01-03T03:09:39.2709043+08:00",
      "重生补偿时间": "2026-01-03T03:09:32.7970853+08:00"
    }
  }
}
```

## 反馈
- 优先发issued -> 共同维护的插件库：https://github.com/UnrealMultiple/TShockPlugin
- 次优先：TShock官方群：816771079
- 大概率看不到但是也可以：国内社区trhub.cn ，bbstr.net , tr.monika.love